<html>
<title>Road Traffic Mortality Around the World</title>
<script src="https://d3js.org/d3.v4.js"></script>
<style>
    p.p1{
    max-width: 950px;
    margin-left: 20px;
  }
  div.tooltip {
    position: absolute;
    text-align: center;
    background-color: white;
    border: solid;
    border-radius: 5px;
    border-width: 2px;
    padding: 5px;
    pointer-events: none;
  }
</style>
<body>
<h1>&nbsp;&nbsp;Traffic Mortality Distribution</h1>
<p>&nbsp;</p>
<p class="p1">
    The last scene here focuses on the different types of traffic-related fatalities
    and how they vary from region to region. Note that the totals for each region 
    may not add to 100 because these are not the only four possibilities for traffic-related
    fatalities; they are merely the most common ones. 
</p>
<p class="p1">
<b>Select from the list below to see each graph:</b><br>
<input type="radio" onclick="update(value)" name="onclick" value="Pedestrians" checked="checked" />Pedestrians<br>
<input type="radio" onclick="update(value)" name="onclick" value="Drivers/Passengers of Motorized 4-Wheeled Vehicles" />Drivers/Passengers of Motorized 4-Wheeled Vehicles<br>
<input type="radio" onclick="update(value)" name="onclick" value="Drivers/Passengers of Motorized 2- or 3-Wheeled Vehicles" />Drivers/Passengers of Motorized 2- or 3-Wheeled Vehicles<br>
<input type="radio" onclick="update(value)" name="onclick" value="Cyclists" />Cyclists
</p>




<div id="my_dataviz"></div>
<script>
var width=600;
var height=350;
var margin=100;
var xs=d3.scaleBand().range([0, width]).padding(0.2);
var ys=d3.scaleLinear().range([height,0]);
var color = ["#66c2a5", "#fc8d62", "#8da0cb", "#e78ac3","#a6d854", "#ffd92f", "#e5c494"];
div = d3.select("body").append("div")	
        .attr("class", "tooltip")				
        .style("opacity", 0); 
var svg = d3.select("#my_dataviz").append("svg")
    .attr("width",width+2*margin)
    .attr("height",height+3*margin)
    .append("g").attr("transform","translate("+margin+","+1.5*margin+")")

var xAxis = svg.append("g")
    .attr("transform","translate(0,"+height+")")
var yAxis = svg.append("g")
    //.attr("transform","translate("+margin+","+margin+")")

svg.append("text")
    .attr("transform","translate("+(width/2-30)+","+(height+1.2*margin)+")")
    .style("text-anchor","middle")
    .text("Regions");

svg.append("text")
    .attr("transform","rotate(-90)")
    .attr("y", 50-margin)
    .attr("x",0-(height/2))
    //.attr("dy","1em")
    .style("text-anchor","middle")
    .text("Percentage of Traffic Related Fatalities");

svg.append("text")
    .attr("x",(width/2-200))
    .attr("y",-50)
    .attr("text-anchor","center")
    .attr("font-weight",600)
    .style("font-size","18px")
    .text("Traffic-Related Fatalities Distributions by Region");

function update(selectedVar) {
    var url;
    if (selectedVar=="Pedestrians"){
        url="https://awang288.github.io/raw_data/DistrPed.csv"
    }else if (selectedVar=="Drivers/Passengers of Motorized 4-Wheeled Vehicles"){
        url="https://awang288.github.io/raw_data/Distr4Wheeled.csv"
    }else if (selectedVar=="Drivers/Passengers of Motorized 2- or 3-Wheeled Vehicles"){
        url="https://awang288.github.io/raw_data/Distr23Wheeled.csv"
    }else if (selectedVar=="Cyclists"){
        url="https://awang288.github.io/raw_data/DistrCyclists.csv"
    }
    d3.csv(url,function(d){return {Region: d.Region, Value : d.Value }},  
        function(data){
            xs.domain(data.map(function(d) {return d.Region;}))
            xAxis.transition().duration(1000).call(d3.axisBottom(xs))
                .selectAll("text")
                .attr("transform", "translate(-10,0)rotate(-45)")
                .style("text-anchor", "end");

            ys.domain([0, d3.max(data, function(d) { return +d.Value }) ]);
            yAxis.transition().duration(1000).call(d3.axisLeft(ys));

            var bars = svg.selectAll("rect").data(data)
            bars.enter().append("rect").merge(bars).transition().duration(1000)
                .attr("x", function(d) { return xs(d.Region); })
                .attr("y", function(d) { return ys(d.Value); })
                .attr("width", xs.bandwidth())
                .attr("height", function(d) { return height-ys(d.Value); })
                .attr("fill", function (d,i) { return color[i] })
                .on("mouseover", function(d) {
                div.html("Region: "+d.Region
                +"<br>% of Fatalities: "+d.Value+"%")
                .style("top", (event.pageY)-150+"px")
                .style("left",(event.pageX)-50+"px")
                .style("opacity", .85);		
                })					
                .on("mouseout", function(d) {div.style("opacity", 0);})
        }
    )
}
update('Pedestrians')

</script>

<p class="p1">motorized 2/3-- SA<br>
motorized 4: NA, SA<br>
cycling: europe, latin America<br>
pedestrian: NA<br>
<input type="button" onclick="location.href='est_road_deaths.html';" value="Previous" />&nbsp;
<input type="button" onclick="location.href='index.html';" value="Restart" />
</p>


</body>
</html>