<html>
<title>US Road Traffic Mortality</title>
<script src="https://d3js.org/d3.v5.js"></script>
<style>
  div.tooltip {
    position: absolute;
    text-align: center;
    background-color: white;
    border: solid;
    border-radius: 5px;
    border-width: 2px;
    padding: 5px;
    pointer-events: none;
  }
  .myCircle:hover {
    stroke:black
  }

</style>
<body onload='init()'>
<h1>&nbsp;&nbsp;US Road Traffic Mortality</h1>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Amanda Wang</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;July 20, 2021</p>
<p>&nbsp;</p>
<p>Over the past few decades, there has been a general decrease in the number of traffic-related
  fatalities in the United States. In addition to the increased safety features of many modern cars,
  such as automatic emergency braking, lane departure detection, and blind spot detection, there have
  been more safety programs in recent years focusing on seatbelt use and the dangers of impaired driving.
  There has also been an increase in legislation regarding these areas, as noted in the graph below.
</p>
<svg width=1000 height=1000></svg>
<script>
async function init() {
  data = await d3.csv("https://awang288.github.io/raw_data/US_data.csv");
  var width=750;
  var height=500;
  var margin=100;

  var xs=d3.scaleLinear().domain([1999,2021]).range([0,width]);
  var ys=d3.scaleLinear().domain([11,16.5]).range([height,0]);
  var xTickLabels=["2000","2005","2010","2015","2020"]

  div = d3.select("body").append("div")	
    .attr("class", "tooltip")				
    .style("opacity", 0); 

  
  d3.select("svg")
    .attr("width",width+2*margin)
    .attr("height",height+2*margin)
    .append("g")
    .attr("transform","translate("+margin+","+margin+")")
    //.selectAll("body").data(data).enter()
    .append("path")
    .datum(data)
    .attr("d", d3.line()
      .x(function(d) { return xs(d.Year) })
      .y(function(d) { return ys(d.Value) }))
    .attr("fill","none")
    .attr("stroke", "skyblue")
    .attr("stroke-width", 1.5);
  

  d3.select("svg")
    .attr("width",width+2*margin)
    .attr("height",height+2*margin)
    .append("g").attr("transform","translate("+margin+","+margin+")")
    .selectAll("body").data(data).enter().append("circle")
    .attr("class","myCircle")
    .attr("cx",function(d) {return xs(d.Year);})
    .attr("cy",function(d) {return ys(d.Value);})
    .attr("r",5)
    .attr("stroke",d3.color("dodgerblue"))
    .attr("stroke-width",2)
    .attr("fill",d3.color("dodgerblue"))
    .on("mouseover", function(d) {
      div.html("Year: "+d.Year+"<br>Number of Fatalities: "+d.Value+
          "<br>% of Deaths-Female: "+d.Female+"%<br>% of Deaths-Male: "+d.Male+"%")
        .style("top", (event.pageY)-105+"px")
        .style("left",(event.pageX)-60+"px")
        .style("opacity",.85);
        })
    .on("mouseout", function(d) {div.style("opacity", 0);});

  d3.select("svg").append("g")
    .attr("transform","translate("+margin+","+margin+")")
    .call(d3.axisLeft(ys));

  d3.select("svg").append("g")
    .attr("transform","translate("+margin+","+(height+margin)+")")
    .call(d3.axisBottom(xs)
          .ticks(5)
          .tickValues([2000,2005,2010,2015,2020])
          .tickFormat(function (d,i) {
            return xTickLabels[i]})
          );

  d3.select("svg").append("text")
    .attr("transform","translate("+(width/2+100)+","+(height+margin+50)+")")
    .style("text-anchor","middle")
    .text("Year");

  d3.select("svg").append("text")
    .attr("transform","rotate(-90)")
    .attr("y", 0-margin.left)
    .attr("x",-50-(height/2))
    .attr("dy","1em")
    .style("text-anchor","middle")
    .text("Number of Traffic-Related Fatalities per 100,000 Population");

  d3.select("svg").append("text")
    .attr("x",(width/2-100))
    .attr("y",margin/2)
    .attr("text-anchor","center")
    .attr("font-weight",600)
    .style("font-size","24px")
    .text("Traffic-Related Fatalities in the United States");

  // First annotation
  d3.select("svg").append("line")
    .attr("x1",190).attr("y1",160)
    .attr("x2",190).attr("y2",220)
    .attr("stroke","#001932").attr("stroke-width",1)

  d3.select("svg").append("text")
    .attr("x",130).attr("y",250).attr("fill","#001932")
    .text("November 2001")
    .style("font-weight",1000)

  d3.select("svg").append("text")
    .attr("x",130).attr("y",275).attr("fill","#001932")
    .text("New York becomes the first state")

  d3.select("svg").append("text")
    .attr("x",130).attr("y",300).attr("fill","#001932")
    .text("to implement a law banning all ")

  d3.select("svg").append("text")
    .attr("x",130).attr("y",325).attr("fill","#001932")
    .text("drivers from using hand-held")

  d3.select("svg").append("text")
    .attr("x",130).attr("y",350).attr("fill","#001932")
    .text("cell phones while driving.")

  // Second annotation
  d3.select("svg").append("line")
    .attr("x1",300).attr("y1",145)
    .attr("x2",350).attr("y2",110)
    .attr("stroke","#001932").attr("stroke-width",1)

  d3.select("svg").append("text")
    .attr("x",370).attr("y",100)
    .attr("fill","#001932")
    .text("2004-2005")
    .style("font-weight",1000)
  d3.select("svg").append("text")
    .attr("x",370).attr("y",125)
    .attr("fill","#001932")
    .text("Distracted driving laws in Connecticut and Washington D.C. start to")
  d3.select("svg").append("text")
    .attr("x",370).attr("y",150)
    .attr("fill","#001932")
    .text("include language specifically regarding text messaging.")

  // Third annotation
  d3.select("svg").append("line")
    .attr("x1",425).attr("y1",360)
    .attr("x2",500).attr("y2",280)
    .attr("stroke","#001932").attr("stroke-width",1)

  d3.select("svg").append("text").attr("x",520).attr("y",250)
    .attr("fill","#001932")
    .text("January 2008").style("font-weight",1000)
  d3.select("svg").append("text").attr("x",520).attr("y",275)
    .attr("fill","#001932")
    .text("Washington state passes the first law explicitly")
  d3.select("svg").append("text").attr("x",520).attr("y",300)
    .attr("fill","#001932")
    .text("banning all drivers from texting. 26 other states")
  d3.select("svg").append("text").attr("x",520).attr("y",325)
    .attr("fill","#001932")
    .text("ended up passing similar laws within 3 years.")
}

</script>

<p>
<input type="button" onclick="location.href='est_road_deaths.html';" value="Next" />
</p>
<br>
<br>
<p>Data Sources:<br>
  https://www.who.int/data/gho/data/indicators/indicator-details/GHO/estimated-road-traffic-death-rate-(per-100-000-population)<br>
  https://data.worldbank.org/indicator/NY.GDP.PCAP.CD?end=2020&start=1990<br>
  <br>
  Articles:<br>
  https://www.who.int/news-room/fact-sheets/detail/road-traffic-injuries<br>
  https://www.nhtsa.gov/traffic-deaths-decreased-2018-still-36560-people-died<br>
  https://www.cdc.gov/transportationsafety/seatbeltbrief/index.html<br>
  https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4001674/</p>
</body>
</html>